<section class="card" style="padding:16px">
  <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
    <div style="font-size:18px;font-weight:700">Patients</div>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <input id="patients-search" type="search" placeholder="Search by name, student number..." style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);min-width:300px">
      <button class="btn" id="newPatientBtn">Register Patient</button>
    </div>
  </div>

  <div style="margin-bottom:10px;color:var(--muted);font-size:13px">
    Results: <span id="patients-count">â€”</span>
  </div>

  <div style="overflow:auto">
    <table id="patients-table" style="width:100%;border-collapse:collapse">
      <thead style="text-align:left;color:var(--muted);font-size:13px">
        <tr>
          <th style="padding:10px 8px">Name</th>
          <th style="padding:10px 8px">Student #</th>
          <th style="padding:10px 8px">Year</th>
          <th style="padding:10px 8px">Last Visit</th>
          <th style="padding:10px 8px">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr class="row" style="border-top:1px solid rgba(0,0,0,0.04)">
          <td style="padding:10px 8px" data-patient-name="Juan Dela Cruz">Juan Dela Cruz</td>
          <td style="padding:10px 8px" data-patient-id="2021-01234">2021-01234</td>
          <td style="padding:10px 8px">3</td>
          <td style="padding:10px 8px">2025-11-14</td>
          <td style="padding:10px 8px">
            <button class="btn" data-open-profile="2021-01234">Open</button>
            <button class="btn new-encounter-btn" data-patient-id="2021-01234" style="background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03)">New Encounter</button>
          </td>
        </tr>
        <tr class="row">
          <td style="padding:10px 8px" data-patient-name="Maria Santos">Maria Santos</td>
          <td style="padding:10px 8px" data-patient-id="2020-04567">2020-04567</td>
          <td style="padding:10px 8px">4</td>
          <td style="padding:10px 8px">2025-10-28</td>
          <td style="padding:10px 8px">
            <button class="btn" data-open-profile="2020-04567">Open</button>
            <button class="btn new-encounter-btn" data-patient-id="2020-04567" style="background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03)">New Encounter</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

</section>

<script>
  // small UI helpers for demo
  document.getElementById('patients-count').textContent = document.querySelectorAll('#patients-table tbody tr').length;

  // wire open profile buttons to navigate (Open button)
  document.querySelectorAll('[data-open-profile]').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const id = btn.getAttribute('data-open-profile');
      // dispatch navigation event to app
      window.dispatchEvent(new CustomEvent('app:navigate', { detail: { page: 'patient-profile', params: { id } }}));
    });
  });

  // New Encounter button on rows
  document.querySelectorAll('.new-encounter-btn').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const id = btn.getAttribute('data-patient-id');
      const row = btn.closest('tr');
      const name = row.querySelector('[data-patient-name]').textContent;

      window.dispatchEvent(new CustomEvent('app:navigate', { detail: { page: 'encounter', params: { patientId: id, patientName: name } }}));
    });
  });

  // search (client-side demo)
  const searchInput = document.getElementById('patients-search');
  searchInput.addEventListener('input', () => {
    const q = searchInput.value.trim().toLowerCase();
    document.querySelectorAll('#patients-table tbody tr').forEach(tr=>{
      tr.style.display = (q === '' || tr.innerText.toLowerCase().includes(q)) ? '' : 'none';
    });
    const visible = Array.from(document.querySelectorAll('#patients-table tbody tr')).filter(r=>r.style.display !== 'none').length;
    document.getElementById('patients-count').textContent = visible;
  });

  // new patient (Register Patient)
  document.getElementById('newPatientBtn').addEventListener('click', ()=>{
    alert('Open patient registration modal (implement later).');
  });
</script>