<section class="page">
  <div class="card" style="max-width:1100px;margin:12px auto">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px">
      <h2 style="margin:0">New Encounter</h2>
      <div style="color:var(--muted)">Draft autosave: <span id="encounter-draft-state">saved</span></div>
    </div>

    <form id="encounter-form" style="margin-top:14px; display:grid; grid-template-columns: 1fr 320px; gap:18px">
      <!-- LEFT: main form -->
      <div>
        <div class="card" style="margin-bottom:12px">
          <label class="label-muted">Patient</label>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="enc-patient" class="input search" type="text" placeholder="Search patient (name or student #)" style="flex:1">
            <button type="button" class="btn" id="selectPatientBtn">Select</button>
          </div>
        </div>

        <div class="card" style="margin-bottom:12px">
          <label class="label-muted">Chief Complaint</label>
          <input id="chief-complaint" class="input" type="text" placeholder="e.g., Fever, cough">
        </div>

        <div class="card" style="margin-bottom:12px">
          <label class="label-muted">History of Present Illness (HPI)</label>
          <textarea id="hpi" class="input" rows="6" placeholder="Describe the HPI..."></textarea>
        </div>

        <div class="card" style="margin-bottom:12px">
          <label class="label-muted">Physical Exam</label>
          <textarea id="exam" class="input" rows="4" placeholder="Findings..."></textarea>
        </div>

        <div class="card" style="margin-bottom:12px">
          <label class="label-muted">Assessment / Plan</label>
          <textarea id="plan" class="input" rows="4" placeholder="Assessment and plan..."></textarea>
        </div>

        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button type="button" class="btn" id="saveDraft">Save Draft</button>
          <button type="submit" class="btn">Save & Sign</button>
        </div>
      </div>

      <!-- RIGHT: vitals + metadata + attachments -->
      <aside>
        <div class="card" style="margin-bottom:12px">
          <h3 style="margin:0 0 8px 0">Vitals</h3>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <input id="v-temp" class="input" placeholder="Temp Â°C" />
            <input id="v-pulse" class="input" placeholder="Pulse" />
            <input id="v-bp" class="input" placeholder="BP" />
            <input id="v-weight" class="input" placeholder="Weight kg" />
          </div>
        </div>

        <div class="card" style="margin-bottom:12px">
          <h3 style="margin:0 0 8px 0">Metadata</h3>
          <div style="display:flex;flex-direction:column;gap:8px">
            <select id="visit-type" class="input">
              <option>Walk-in</option>
              <option>Scheduled</option>
              <option>Follow-up</option>
            </select>
            <input id="clinician" class="input" placeholder="Clinician (auto-fill)" />
            <input id="encounter-date" class="input" type="datetime-local" />
          </div>
        </div>

        <div class="card">
          <h3 style="margin:0 0 8px 0">Attachments</h3>
          <input type="file" id="attachment" />
        </div>
      </aside>
    </form>
  </div>
</section>

<script>
  // keep existing autosave logic (unchanged)
  const form = document.getElementById('encounter-form');
  const draftState = document.getElementById('encounter-draft-state');

  function saveDraft(){
    const data = {
      patient: document.getElementById('enc-patient').value,
      complaint: document.getElementById('chief-complaint').value,
      hpi: document.getElementById('hpi').value,
      exam: document.getElementById('exam').value,
      plan: document.getElementById('plan').value
    };
    localStorage.setItem('encounter_draft', JSON.stringify(data));
    draftState.textContent = 'saved';
  }

  document.getElementById('saveDraft')?.addEventListener('click', saveDraft);

  form.addEventListener('submit', (e)=>{
    e.preventDefault();
    saveDraft();
    alert('Encounter saved (demo). Hook up API to persist.');
    localStorage.removeItem('encounter_draft');
    draftState.textContent = 'no draft';
  });

  const existing = localStorage.getItem('encounter_draft');
  if(existing){
    try {
      const obj = JSON.parse(existing);
      document.getElementById('enc-patient').value = obj.patient || '';
      document.getElementById('chief-complaint').value = obj.complaint || '';
      document.getElementById('hpi').value = obj.hpi || '';
      document.getElementById('exam').value = obj.exam || '';
      document.getElementById('plan').value = obj.plan || '';
      draftState.textContent = 'loaded';
    } catch(e){ console.warn('bad draft'); }
  }
</script>

